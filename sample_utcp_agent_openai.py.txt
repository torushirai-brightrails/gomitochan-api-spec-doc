"""
Reference: https://github.com/universal-tool-calling-protocol/utcp-agent
"""

"""
Basic OpenAI example for UtcpAgent.

This example demonstrates how to use UtcpAgent with OpenAI GPT models.
"""
import asyncio
import logging
import sys, os
from langchain_openai import ChatOpenAI
from utcp_agent import UtcpAgent

# Configure logging
logging.basicConfig(
    level=logging.INFO,
    format="%(asctime)s [%(levelname)s] %(name)s:%(lineno)d - %(message)s",
    handlers=[logging.StreamHandler(sys.stdout)],
)

# Disable UTCP library logging
logging.getLogger("utcp").setLevel(logging.WARNING)


async def main():
    """Example using OpenAI GPT models."""
    print("=== UtcpAgent with OpenAI ===")

    # Create an UTCP Agent
    agent = await UtcpAgent.create(
        llm=ChatOpenAI(
            model="gpt-5-nano", 
            api_key=os.getenv("OPENAI_API_KEY"),
        ),
        utcp_config={
            "manual_call_templates": [
                {
                    "name": "getGarbageItemsByCity",
                    "call_template_type": "http",
                    "http_method": "GET",
                    "url": "https://api-gateway.gomitochan.net/v1/utcp",
                    "content_type": "application/json",
                }
            ],
            "variables": {
                "getGarbageItemsByCity_API_KEY": os.getenv("GOMITOCHAN_API_KEY")
            },
        },
    )

    print("üß† UTCP Agent ready. Type 'exit' to quit.")
    while True:
        user_input = input("You: ").strip()
        if user_input.lower() in ["exit", "quit", "q"]:
            print("üëã ÁµÇ‰∫Ü„Åó„Åæ„Åô„ÄÇ")
            break
        try:
            user_prompt = "„ÅÇ„Å™„Åü„ÅØ„ÄÅ„Åî„Åø„Å´Èñ¢„Åô„Çã„Åì„Å®„ÄÅ„Åî„Åø„Å´‰º¥„ÅÜÁí∞Â¢É„Å∏„ÅÆÂΩ±Èüø„ÇÑË≤¢ÁåÆ„ÄÅ„Åî„ÅøÂá∫„Åó„ÄÅ„Åî„ÅøÂàÜÂà•„ÄÅ„Åî„ÅøÂΩìÁï™„Å´Èñ¢„Åô„ÇãÂïè„ÅÑÂêà„Çè„Åõ„ÅÆ„ÅøËøîÁ≠î„Åô„Çã„Åì„Å®„Åå„Åß„Åç„Åæ„Åô„ÄÇ„Åù„Çå‰ª•Â§ñ„ÅÆÂïè„ÅÑÂêà„Çè„Åõ„ÅØÂØæÂøú„Åß„Åç„Å™„ÅÑ„ÅÆ„Åß„ÄÅ„ÅäÊñ≠„Çä„ÅÆËøîÁ≠î„Çí„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ‰ª•Èôç„ÅåÂïè„ÅÑÂêà„Çè„Åõ„ÅÆÂÜÖÂÆπ„Å´„Å™„Çä„Åæ„Åô„ÄÇ=> "
            response = await agent.chat(f"{user_prompt}{user_input}")
            print(f"Agent: {response}")
        except Exception as e:
            print(f"‚ö†Ô∏è „Ç®„É©„Éº: {e}")

if __name__ == "__main__":
    asyncio.run(main())